<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üèùÔ∏è Catan Leaderboard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Poppins:wght@400;600;700&display=swap');

  :root {
    --bg1: #8B4513;
    --bg2: #C85A17;
    --bg3: #E9C46A;
    --bg4: #F4A261;
    --text: #fff5e1;
    --glass: rgba(255,255,255,0.12);
    --glow: rgba(255,255,255,0.2);
    --gold: #B8860B;
    --silver: #9C9C9C;
    --bronze: #CD7F32;
  }

  body.dark-mode {
    --bg1: #2F1B12;
    --bg2: #44200F;
    --bg3: #66320F;
    --bg4: #8B4513;
    --text: #f1e3d3;
    --glass: rgba(0,0,0,0.4);
    --glow: rgba(255,255,255,0.05);
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    color: var(--text);
    overflow-x: hidden;
    background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
    background-size: 400% 400%;
    animation: gradientShift 20s ease infinite;
    transition: background 1s ease, color 0.4s ease;
    position: relative;
  }

  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* ü™µ Catan board background */
  body::before {
    content: "";
    background: url('catan.png') center/contain repeat;
    background-color: #000;
    filter: blur(6px) brightness(0.7);
    position: fixed;
    inset: 0;
    z-index: -2;
  }
  
  body::after {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: -1;
  }

  h1 {
    text-align: center;
    margin: 50px 0 20px;
    font-size: 3.2rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-shadow: 0 0 20px rgba(0,0,0,0.5);
    font-family: 'MedievalSharp', cursive;
  }

  .leaderboard {
    width: 90%;
    max-width: 900px;
    margin: 0 auto 50px;
    background: var(--glass);
    border-radius: 20px;
    backdrop-filter: blur(15px);
    box-shadow: 0 0 25px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.1);
  }

  table { width: 100%; border-collapse: collapse; }
  thead { background: rgba(255,255,255,0.45); }
  th, td {
    padding: 16px 20px;
    text-align: center;
    font-size: 1.1rem;
    text-shadow: none;
  }
  th {
    letter-spacing: 1px;
    text-transform: uppercase;
    font-weight: 600;
  }
  tr { transition: all 0.4s ease; }
  tr:hover { background: rgba(255,255,255,0.1); transform: scale(1.01); }

  /* üèÜ Top 3 ranks (no glow now) */
  .rank-1 td {
    color: var(--gold);
    font-weight: 700;
    text-shadow: none !important;
  }
  .rank-2 td {
    color: var(--silver);
    font-weight: 600;
    text-shadow: none !important;
  }
  .rank-3 td {
    color: var(--bronze);
    font-weight: 600;
    text-shadow: none !important;
  }

  footer {
    text-align: center;
    opacity: 0.9;
    margin-bottom: 30px;
    font-size: 0.9rem;
    font-family: 'Poppins', sans-serif;
  }

  .toggle-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0,0,0,0.3);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 10px 16px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    backdrop-filter: blur(5px);
    transition: all 0.4s ease;
    box-shadow: 0 0 10px rgba(255,255,255,0.2);
  }
  .toggle-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }

</style>
</head>
<body class="dark-mode">
  <button class="toggle-btn" id="theme-toggle">‚òÄÔ∏è Light Mode</button>
  <h1>üèùÔ∏è Catan Leaderboard</h1>

  <div class="leaderboard">
    <table id="leaderboard-table">
      <thead><tr id="table-header"></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>‚ú® Last updated: <span id="update-time"></span></footer>

  <script>
    const GOOGLE_SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTe2PbXFjzjLBgwjIMQiwXnynRhglLmTubZzm8nQG8nibfo3kJqiR-tucGdMCr6Rm-5KBhhrySF2oVB/pub?output=csv";

    async function loadLeaderboard() {
      try {
        const response = await fetch(GOOGLE_SHEET_CSV_URL + "&t=" + new Date().getTime());
        const data = await response.text();

        const lines = data.trim().split("\n");
        const headers = lines[0].split(",").map(h => h.trim());
        const rows = lines.slice(1).map(r => r.split(","));

        const skipIndices = headers
          .map((h, i) => /phone/i.test(h) ? i : null)
          .filter(i => i !== null);
        const visibleHeaders = headers.filter((_, i) => !skipIndices.includes(i));

        const headerRow = document.getElementById("table-header");
        headerRow.innerHTML = "<th>Rank</th>" + visibleHeaders.map(h => `<th>${h}</th>`).join("");

        const players = rows.map(row => {
          const obj = {};
          headers.forEach((h, i) => {
            if (!skipIndices.includes(i)) obj[h] = row[i];
          });
          return obj;
        });

        const scoreKey = headers.find(h => /score/i.test(h)) || visibleHeaders[visibleHeaders.length - 1];
        players.sort((a, b) => (parseFloat(b[scoreKey]) || 0) - (parseFloat(a[scoreKey]) || 0));

        const tbody = document.querySelector("#leaderboard-table tbody");
        tbody.innerHTML = "";
        players.forEach((p, i) => {
          const crown = (i === 0) ? "üëë" : (i === 1) ? "ü•à" : (i === 2) ? "ü•â" : "";
          const rowHTML =
            `<td>${i + 1}</td>` +
            visibleHeaders
              .map(h => `<td>${p[h] || ""}${h.toLowerCase() === "player" ? " " + crown : ""}</td>`)
              .join("");
          const tr = document.createElement("tr");
          tr.className = `rank-${i + 1}`;
          tr.innerHTML = rowHTML;
          tbody.appendChild(tr);
        });

        document.querySelector("#update-time").textContent = new Date().toLocaleString();
      } catch (err) {
        console.error("Error loading leaderboard:", err);
      }
    }

    loadLeaderboard();
    setInterval(loadLeaderboard, 30000);

    // üåô / ‚òÄÔ∏è Theme toggle
    const toggleBtn = document.getElementById("theme-toggle");
    toggleBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      const isDark = document.body.classList.contains("dark-mode");
      toggleBtn.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    });
  </script>
</body>
</html>
